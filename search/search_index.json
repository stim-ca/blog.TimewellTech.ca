{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#about-me","title":"About Me","text":"<p>Sysadmin by day. Father, Husband, and aspiring DevOps Professional by Night</p> <p>why you no build</p>"},{"location":"2023/11/11/powershell-secrets/","title":"PowerShell Secrets","text":""},{"location":"2023/11/11/powershell-secrets/#powershell-secrets-installation","title":"PowerShell Secrets Installation","text":"<p>Microsoft's Installtion Guide</p>"},{"location":"2023/11/11/powershell-secrets/#creating-a-vault-and-adding-a-secret","title":"Creating a Vault and adding a secret","text":""},{"location":"2023/11/11/powershell-secrets/#register-secretvault","title":"Register SecretVault","text":"<pre><code>Read-Host -AsSecureString | Export-Clixml -Path C:\\Temp\\TTELAB.xml -Force\n\n$secureVaultPasswordPath = 'C:\\Temp\\TTELAB.xml'\n\nRegister-SecretVault -Name TTELAB -ModuleName Microsoft.PowerShell.SecretStore -DefaultVault\n\n$vaultUnlockPassword = Import-CliXml -Path $secureVaultPasswordPath\n\nUnlock-SecretStore -Password $vaultUnlockPassword\n\n$storeConfiguration = @{\n    Authentication = 'Password'\n    PasswordTimeout = 3600 # 1 hour\n    Interaction = 'None'\n    Confirm = $false\n}\nSet-SecretStoreConfiguration @storeConfiguration\n</code></pre>"},{"location":"2023/11/11/powershell-secrets/#create-a-secret","title":"Create a Secret","text":"<pre><code>$TTEESX01 = Get-Credential root\n\nSet-Secret -Name 'TTE-ESX-01' -Secret $TTEESX01\n</code></pre>"},{"location":"2023/11/11/powershell-secrets/#use-a-secret-in-a-script","title":"Use a secret in a script","text":"<p>Provisoning a new VM</p> <pre><code># Secret Preamble\n$secureVaultPasswordPath = 'C:\\Temp\\TTELAB.xml'\n$vaultUnlockPassword = Import-CliXml -Path $secureVaultPasswordPath\nUnlock-SecretStore -Password $vaultUnlockPassword\n$esxiPassword = Get-Secret -Name 'TTE-ESX-01'\n\n# Connect to ESXi Host\nConnect-VIServer -Server '10.0.1.50' -Credential $esxiPassword\n\n# First Time only. Can be commented out after\n$copySource = 'C:\\Temp\\ISO\\Windows Server 2022.iso'\n$copyDestination = 'vmstores:\\10.0.1.50@443\\ha-datacenter\\data\\isos\\Windows Server 2022.iso'\n\nCopy-DatastoreItem $copySource $copyDestination -Force\n\n$newVMArguments = @{\n    CD             = $true\n    CoresPerSocket = 4  \n    Datastore      = 'data'\n    DiskGB         = 50\n    GuestId        = 'windows2019srv_64Guest'\n    MemoryGB       = 16\n    NetworkName    = 'VM Network'\n    NumCpu         = 4\n    Name           = 'TTE-DC-01'\n}\n\nNew-VM @newVMArguments\n\n# Connect ISO to VM's CD Drive\nGet-CDDrive -VM $newVMArguments.Name | \n    Set-CDDrive -IsoPath '[data] isos/Windows Server 2022.iso' -StartConnected $true\n\n# Start VM\n\nStart-VM -VM $newVMArguments.Name\n\n# Open Console Window\n# Note: VMRC must be installed on local machine\n# Otherwise head to the web console\n\nOpen-VMConsoleWindow -VM $newVMArguments.Name\n</code></pre>"},{"location":"2023/11/12/vsphere-80-install--configuration/","title":"VSphere 8.0 Install & Configuration","text":"","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#prerequisites","title":"Prerequisites","text":"<ul> <li>VMware vSphere 8.0 ISO</li> <li>Sign-up on VMWare's site here to download the evaluation copy</li> <li>USB Drive</li> <li>Hardware that meets VMware's Compatibility Guide</li> <li>VMware's PowerCLI PowerShell module</li> <li>VMware Docs for installation</li> </ul>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#gui-installation","title":"GUI Installation","text":"","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#welcome-to-the-vmware-esxi-801-installation","title":"Welcome To the VMware ESXi 8.0.1 Installation","text":"<p>Press <code>Enter</code> at this screen to continue</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#end-user-license-agreement-eula","title":"End User License Agreement (EULA)","text":"<p>Press <code>F11</code> to Accept and Continue to progress</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#select-a-disk-to-install-or-upgrade","title":"Select a Disk to Install or Upgrade","text":"<p>Choose which disk you want to install the OS. Here I chose the 278GB drive as the 1.09TB drive drive is going to be used for the datastore.</p> <p>Write down the last 4 numbers of the other drive it will be used later.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#please-select-a-keyboard-layout","title":"Please select a keyboard layout","text":"<p>Press <code>Enter</code> to select the default layout, or you can select a new layout by using the up and down arrows.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#enter-a-root-password","title":"Enter a root password","text":"<p>Create the password for the root account that you will use to manage the hypervisor. ESXi Password Requirements.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#errorswarnings-found-during-system-scan","title":"Error(s)/Warning(s) Found During System Scan","text":"<p>If there are any issues found, they will be listed here. As you can see my 2 Intel EXeon E5-2620 v4's may no longer be supported by VMware in future releases, and that my BIOS is still currently in Legacy Mode, which I will be changing since I was not aware!</p> <p>Press <code>Enter</code> to continue.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#confirm-install","title":"Confirm Install","text":"<p>Press <code>F11</code> to confirm the installation.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#installation-complete","title":"Installation Complete","text":"<p>After the installation has completed, remove the installation media. Then press <code>Enter</code> to reboot.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#after-first-reboot","title":"After First Reboot","text":"<p>After the first reboot has happened, you'll see the following screen. I have DHCP configured so the host was given <code>10.0.1.107</code>. We'll be using this in the coming sections.</p> <p></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#configuring-with-powercli","title":"Configuring with PowerCLI","text":"<p>We're going to configure;</p> <ul> <li>Static IPv4</li> <li>Disable IPv6</li> <li>Hostname</li> <li>DNS</li> <li>Datastore</li> </ul>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#connecting-to-the-host","title":"Connecting to the host","text":"<p><pre><code># Provide the credentials to the root account\n$ESXiRoot = Get-Credential root\n</code></pre> Enter the root password you used during the installation into the dialog box.</p> <p></p> <p><pre><code># Command to connect to the host\nConnect-VIServer -Server '10.0.1.107' -Credential $ESXiRoot\n</code></pre> You'll receive a Certificate warning. Press P to Accept the self-signed certificate Permanently.</p> <p></p> <p>After a successful connection you'll see the output below.</p> <pre><code>Name                           Port  User\n----                           ----  ----\n10.0.1.107                     443   root\n</code></pre>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#configuring-a-static-ip","title":"Configuring a Static IP","text":"<pre><code>Get-VMHostNetworkAdapter | \n    Select-Object -Property Name,IP,SubnetMask\n</code></pre> <pre><code>Name   IP         SubnetMask\n----   --         ----------\nvmnic0\nvmnic1\nvmnic2\nvmnic3\nvmk0   10.0.1.107 255.255.255.0\n</code></pre> <p>Take note of the name of the interface you're going to be changing, which for me it's <code>vmk0</code>.</p> <pre><code># Select only the adapter you're altering\n$vmk0 = Get-VMHostNetworkAdapter | \n    Where-Object {$_.Name -eq \"vmk0\"}\n\n# Pipe the network adapter to the set command\n$vmk0 | \n    Set-VMHostNetworkAdapter -IP '10.0.1.52' -SubnetMask '255.255.255.0' -IPv6Enabled $false\n</code></pre> <p><pre><code>Perform operation?\nPerforming operation 'Configuring VM host network adapter.' on network adapter with IP '10.0.1.107' and device name 'vmk0'.\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"Y\"):\n</code></pre> Press <code>Enter</code> to continue the operation.</p> <p><pre><code>WARNING: The underlying connection was closed: A connection that was expected to be kept alive was closed by the server.\nSet-VMHostNetworkAdapter : 2023-11-12 10:04:23 PM       Set-VMHostNetworkAdapter                Object reference not set to an instance of an object.\nAt line:1 char:9\n+ $vmk0 | Set-VMHostNetworkAdapter -IP '10.0.1.52' -SubnetMask '255.255 ...\n+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : NotSpecified: (:) [Set-VMHostNetworkAdapter], VimException\n    + FullyQualifiedErrorId : Core_BaseCmdlet_UnknownError,VMware.VimAutomation.ViCore.Cmdlets.Commands.Host.SetVMHostNetworkAdapter\n</code></pre> After the connection has been lost, check your management console and see if the IP address has been configured.</p> <p></p> <p>You have to disconnect your session with the only IP address <code>10.0.1.107</code>.</p> <p><pre><code>Disconnect-VIServer -Server 10.0.1.107 -Force\n</code></pre> <pre><code>Confirm\nAre you sure you want to perform this action?\nPerforming the operation \"Disconnect VIServer\" on target \"User: root, Server: 10.0.1.107, Port: 443\".\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"Y\"):\n</code></pre> Press <code>Enter</code> to disconnect.</p> <p>Reconnect the PowerShell session to the ESXi host with the new IP <code>10.0.1.52</code>. <pre><code># Provide the credentials to the root account\n$ESXiRoot = Get-Credential root\n\n# Command to connect to the host\nConnect-VIServer -Server '10.0.1.52' -Credential $ESXiRoot\n</code></pre> Press <code>P</code> to accept the certificate again.</p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#setting-hostname-dns-and-disabling-ipv6","title":"Setting HostName, DNS, and disabling IPv6","text":"<p>Since we only have a basic network setup, we don't need to specify a VMHostNetwork. </p> <p><pre><code>Get-VMHostNetwork | \n    Set-VMHostNetwork -HostName TTE-ESX-02 -DnsFromDhcp $false -DnsAddress 10.0.1.2,10.0.1.3 -IPv6Enabled $false\n</code></pre> <pre><code>WARNING: Disabling IPv6 will take effect after host reboot.\nHostName     DomainName   DnsFro ConsoleGateway  ConsoleGatewayD DnsAddress\n                          mDhcp                  evice\n--------     ----------   ------ --------------  --------------- ----------\nTTE-ESX-02   AD.Timewe... False                                  {10.0.1.2, 10.0.1.3}\n</code></pre> We will reboot the server later for IPv6 to be disabled.</p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#creating-a-new-datastore","title":"Creating a New Datastore","text":"<p>Get the device path on which you want to create the new datastore. <pre><code># Save to variable for later\n$VMHostDisk = Get-VMHostDisk\n# Output\n$VMHostDisk\n</code></pre> <pre><code>DeviceName                                                      TotalSectors\n----------                                                      ------------\n/vmfs/devices/disks/naa.6d0946600a41e9002ca66ae9f0e32e0b          2339373056\n/vmfs/devices/disks/naa.6d0946600a41e9002ca66c7708a11de7           584843264\n</code></pre> If you wrote down the last 4 numbers from before, you can tell that the one with more sectors is the drive I'm going to be using for the new datastore.</p> <p><pre><code>New-Datastore -Vmfs -Name 'data' -Path $VMHostDisk[0].ScsiLun.CanonicalName -VMHost '10.0.1.52' -FileSystemVersion 6\n</code></pre> <pre><code>Name                               FreeSpaceGB      CapacityGB\n----                               -----------      ----------\ndata                                 1,113.827       1,115.250\n</code></pre></p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/12/vsphere-80-install--configuration/#restarting-the-esxi-host","title":"Restarting the ESXi Host","text":"<p><pre><code>Get-VMHost | \n    Restart-VMHost -Force\n</code></pre> <pre><code>Confirm\nAre you sure you want to perform this action?\nPerforming the operation \"Restart VM host.: Force: True\" on target \"10.0.1.52\".\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"Y\"):\n</code></pre> Press <code>Enter</code> to restart the host.</p> <p>VMWare's PowerCLI documentation can be found here.</p> <p>Next Post I'll be copying ISO's and provisioning VMs for the home-lab.</p> <p>Thank you for reading!</p>","tags":["vSphere 8.0","VMware","ESXi","Installation","Configuration","PowerCLI","Virtualization","Datastore","Networking","DNS","IPv6","Root Password","Hardware Compatibility","GUI Installation","VMware PowerCLI","vSphere Installation Guide"]},{"location":"2023/11/13/vsphere-80-continued/","title":"VSphere 8.0 Continued","text":"","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#prerequisites","title":"Prerequisites","text":"<ul> <li>Configured ESXi Host</li> <li>Basic PowerShell Knowledge</li> <li>PowerCli Installed</li> <li>Windows Server 2022 Evaluation ISO</li> <li>Download link</li> <li>VMWare's VMRC Installed</li> <li>Download link</li> </ul>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#connecting-to-esxi-host","title":"Connecting to ESXi host","text":"<p><pre><code>$eSXi01Root = Get-Credential root\n</code></pre> <pre><code>Connect-VIServer -Server '10.0.1.50' -Credential $eSXi01Root\n</code></pre></p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#copying-iso-to-datastore","title":"Copying ISO to Datastore","text":"","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#get-psdrive","title":"Get-PSDrive","text":"<p>To find out the datastore path we're going to use <code>Get-PSDrive</code>.</p> <p><pre><code>Get-PSDrive\n</code></pre> <pre><code>Name           Used (GB)     Free (GB) Provider      Root\n----           ---------     --------- --------      ---\nAlias                                  Alias\nC                 418.38         46.61 FileSystem    C:\\  \nCert                                   Certificate   \\\nD                   8.85         50.89 FileSystem    D:\\\nEnv                                    Environment\nFunction                               Function\nHKCU                                   Registry      HKEY_CURRENT_USER\nHKLM                                   Registry      HKEY_LOCAL_MACHINE\nVariable                               Variable\nvi                                     VimInventory  \\LastConnectedVCenterServer\nvis                                    VimInventory  \\\nvmstore                                VimDatastore  \\LastConnectedVCenterServer\nvmstores                               VimDatastore  \\\nWSMan                                  WSMan\n</code></pre></p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#make-a-directory-to-store-the-isos","title":"Make a Directory to Store the ISOs","text":"<p>We're going to make a new folder named <code>iso</code> on the datastore <code>data</code> that we setup in the last post. You can use <code>tab</code> completion to find the correct path.</p> <pre><code>mkdir vmstores:\\10.0.1.50@443\\ha-datacenter\\data\\iso\n</code></pre>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#transferring-the-iso-to-the-esxi-host","title":"Transferring the ISO to the ESXi Host","text":"<p>The command we're going to use is <code>Copy-DatastoreItem</code>. It requires an <code>Item</code> source and a <code>Destination</code> path.</p> <pre><code>Copy-DatastoreItem -Item 'C:\\Temp\\ISO\\Windows Server 2022.iso' -Destination 'vmstores:\\10.0.1.50@443\\ha-datacenter\\data\\iso\\Windows Server 2022.iso' -Force\n</code></pre> <p></p> <p>The transfer time will depend on your network and disk speeds.</p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#provisioning-a-virtual-machine","title":"Provisioning a Virtual Machine","text":"","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#gathering-required-information","title":"Gathering Required Information","text":"<p><code>GuestID</code>; Information can be found on the vSphere API documentation link.</p> <ul> <li>Click <code>All Enumerations</code></li> <li>In the <code>-- Quick Index --</code> bar search for <code>VirtualMachineGuestOsIdentifier</code> and a list will appear.</li> </ul> <p><code>NetworkName</code>; We can get this the <code>Get-VirtualNetwork</code> command.</p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#new-vm","title":"New-VM","text":"<p>We're going to use a PowerShell Splat to keep the code easier to read. You can read about Splat on Microsoft's docs. To find all available properties you can use the <code>Get-Help</code> command or the VMWare docs.</p> <pre><code>Get-help New-VM -Full\n</code></pre> <p><pre><code>$NewVM_Properties = @{\n    CD             = $true\n    CoresPerSocket = 4\n    Datastore      = 'data'\n    DiskGB         = 50\n    GuestId        = 'windows2022srvNext_64Guest'\n    MemoryGB       = 16\n    Name           = 'TTE-DC-01'\n    NetworkName    = 'VM Network'\n    Notes          = 'Primary Domain Controller for AD.TimewellTech.ca'\n    NumCpu         = 4\n}\n\nNew-VM @NewVM_Properties\n</code></pre> <pre><code>Name                 PowerState Num CPUs MemoryGB\n----                 ---------- -------- --------\nTTE-DC-01            PoweredOff 4        16.000\n</code></pre></p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#add-a-secondary-hdd-to-the-vm-for-the-active-directory-database","title":"Add a Secondary HDD to the VM for the Active Directory Database","text":"<p><pre><code>$NewHardDisk_Properties = @{\n    CapacityGB = '40'\n    Datastore = 'data'\n    Persistence = 'Persistent'\n    VM = \"$($NewVM_Properties.Name)\" \n    # I can't remember what this is called, but it allows us to get the VMName\n}\n\nNew-HardDisk @NewHardDisk_Properties\n</code></pre> <pre><code>CapacityGB      Persistence                                                    Filename\n----------      -----------                                                    --------\n40.000          Persistent                            [data] TTE-DC-01/TTE-DC-01_1.vmdk\n</code></pre></p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#connect-the-iso-to-new-vms-cd-drive","title":"Connect the ISO to New VM's CD Drive","text":"<p><code>$NewVM_Properties.Name</code> Using dot notation to get the VM's Name. </p> <p><code>[data]</code> Is how you have to reference the datastore. I found this out by looking at the GUI</p> <p></p> <p><pre><code>Get-CDDrive -VM $NewVM_Properties.Name | \n    Set-CDDrive -IsoPath '[data] iso/Windows Server 2022.iso' -StartConnected $true\n</code></pre> <pre><code>Confirm\nAre you sure you want to perform this action?\nPerforming the operation \"Setting IsoPath: [data] iso/Windows Server 2022.iso, StartConnected: True, NoMedia: False.\" on    \ntarget \"CD/DVD drive 1\".\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"Y\"):\n</code></pre></p> <p>Press <code>Enter</code> to continue.</p> <pre><code>IsoPath              HostDevice                             RemoteDevice\n-------              ----------                             ------------\n[data] iso/Window...\n</code></pre>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"2023/11/13/vsphere-80-continued/#start-the-virtual-machine-open-a-virtual-console","title":"Start the Virtual Machine &amp; Open a Virtual Console","text":"<p><pre><code>Start-VM -VM $newVMArguments.Name\n</code></pre> <pre><code>Name                 PowerState Num CPUs MemoryGB\n----                 ---------- -------- --------\nTTE-DC-01            PoweredOn  4        16.000\n</code></pre></p> <p>You must have VMRC installed on your local machine otherwise head to your web-gui.</p> <pre><code>Open-VMConsoleWindow -VM $newVMArguments.Name\n</code></pre> <p>A remote console will appear.</p> <p></p> <p>Next post we're going to be configuring the Primary Domain Controller.</p>","tags":["vSphere 8.0","VMware","ESXi","PowerShell","PowerCLI","Windows Server 2022","VMRC","Datastore","ISO","Virtual Machine","Provisioning","Virtual Network","New-VM","New-HardDisk","CDDrive","Virtual Console"]},{"location":"archive/2023/","title":"November 2023","text":""},{"location":"category/virtualization/","title":"Virtualization","text":""},{"location":"category/system-administration/","title":"System Administration","text":""},{"location":"category/vmware/","title":"VMware","text":""},{"location":"category/tutorials/","title":"Tutorials","text":""},{"location":"category/how-to/","title":"How-to","text":""},{"location":"category/it-infrastructure/","title":"IT Infrastructure","text":""}]}